location.query={};var query=location.search.replace("?","").split("&");for(const e of query){var qq=e.split("=");2==qq.length&&""!=qq[1]?location.query[qq[0]]=qq[1]:1==qq.length&&""!=qq[0]&&(location.query[qq[0]]=!0)}function buildSearchString(e){var a=[];for(var t in e)!0===e[t]?a.push(t):a.push(t+"="+e[t]);return"?"+a.join("&")}function guildClick(e){selectedGuild=e+"",window.history.pushState({},null,location.pathname+"?id="+e),$("#wrapper").removeClass("toggled"),$("#sec_basic_settings").css("opacity","0"),$("#sec_category_settings").css("opacity","0"),$("#sec_no_categorys").css("opacity","0"),loadGuildData()}$("#menu-toggle").click((function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled")})),$.getJSON("/api/inftalks/guild/all",(function(e){for(var a in e){var t=e[a].guild;"/guild.html"==location.pathname?$("<li/>",{html:"<a onclick=\"guildClick('"+t.id+"')\">"+(t.name.length<=28?t.name:t.name.substring(0,25)+"...")+"</a>"}).addClass("sidebar-item").appendTo("#sidebar_guilds"):$("<li/>",{html:'<a href="/guild.html?id='+t.id+'">'+(t.name.length<=28?t.name:t.name.substring(0,25)+"...")+"</a>"}).addClass("sidebar-item").click((function(){$("#wrapper").removeClass("toggled"),$("#sec_basic_settings").css("opacity","0"),$("#sec_category_settings").css("opacity","0"),$("#sec_no_categorys").css("opacity","0")})).appendTo("#sidebar_guilds")}}));var guildData={},localGuildData={},selectedGuild=location.query.id||"",selectedCategory=null,selectedTChannel=null,errors={setting_prefix_error:!1,setting_category_channelLimit_error:!1,setting_category_channelUserLimit_error:!1,setting_category_namingRule_error:!1};function loadGuildData(){$.getJSON("/api/inftalks/guild?id="+selectedGuild,(function(e){localGuildData=e,guildData=$.extend(!0,{},localGuildData),localGuildData.guild.categorys.length>0&&(selectedCategory=localGuildData.guild.categorys[0]),localGuildData.guild.textChannels.length>0&&(selectedTChannel=localGuildData.guild.textChannels[0]),console.log("GuildId: "+selectedGuild),updateData(),$("#sec_basic_settings").css("opacity",""),$("#sec_category_settings").css("opacity",""),$("#sec_no_categorys").css("opacity","")}))}function saveGuildData(){guildData=$.extend(!0,{},localGuildData),$.ajax("/api/inftalks/guild?id="+location.query.id,{data:JSON.stringify(guildData),contentType:"application/json",type:"POST"}).fail((function(e){"No token!"==e.responseJSON.error&&location.reload(),console.log(e)})).done((function(e){updateData()}))}function undoGuildData(){localGuildData=$.extend(!0,{},guildData),selectedCategory=localGuildData.guild.categorys.length>0?localGuildData.guild.categorys[0]:null,localGuildData.guild.textChannels.length>0?selectedTChannel=localGuildData.guild.textChannels[0]:selectedCategory=null,updateData()}function updateData(){$(".var_guild").each((function(){this.innerText=localGuildData.guild.name}));var e=$("#setting_language");for(var a of(e.empty(),localGuildData.langlist))if("default"!=a.key){var t=$("<option/>").prop("value",a.key).text(a.langName);localGuildData.guild.language==a.key&&t.prop("selected",!0),t.appendTo(e)}if($("#setting_prefix").prop("value",localGuildData.guild.prefix),errors.setting_prefix_error=""==localGuildData.guild.prefix,$("#sec_basic_settings").css("opacity","1"),localGuildData.guild.categorys.length>0){var l=$("#setting_category");l.empty();var i=0;for(var o of localGuildData.guild.categorys){t=$("<option/>").prop("value",o.id).text(i+": "+o.name);o.id==selectedCategory.id&&t.prop("selected",!0),t.appendTo(l),i++}$("#setting_category_enable").prop("checked",selectedCategory.enableInfTalks),$("#setting_category_allowLock").prop("checked",selectedCategory.allowLock).prop("disabled",!selectedCategory.enableInfTalks),$("#setting_category_allowLock_wrapper")[selectedCategory.enableInfTalks?"removeClass":"addClass"]("disabled"),$("#setting_category_channelLimit").val(selectedCategory.channelLimit).prop("disabled",!selectedCategory.enableInfTalks)[selectedCategory.enableInfTalks?"removeClass":"addClass"]("disabled"),errors.setting_category_channelLimit_error=selectedCategory.channelLimit<0,$("#setting_category_channelUserLimit").val(selectedCategory.channelUserLimit).prop("disabled",!selectedCategory.enableInfTalks)[selectedCategory.enableInfTalks?"removeClass":"addClass"]("disabled"),errors.setting_category_channelUserLimit_error=selectedCategory.channelUserLimit<0||selectedCategory.channelUserLimit>99,$("#setting_category_namingRule").val(selectedCategory.namingRule).prop("disabled",!selectedCategory.enableInfTalks)[selectedCategory.enableInfTalks?"removeClass":"addClass"]("disabled"),$("#setting_category_namingRule_tip").text(selectedCategory.namingRule.length+" / 500"),errors.setting_category_namingRule_error=selectedCategory.namingRule.length>500,$("#sec_category_settings").css("opacity","1"),$("#sec_category_settings").show(),$("#sec_no_categorys").hide()}else $("#sec_category_settings").hide(),$("#sec_no_categorys").show(),$("#sec_no_categorys").css("opacity","1");for(err in errors)$("#"+err)[errors[err]?"show":"hide"]().css("opacity",errors[err]?"1":"0");$("#setting_category_namingRule_tip")[errors.setting_category_namingRule_error?"addClass":"removeClass"]("error");var n=isInEquivalent(localGuildData.guild,guildData.guild);n?($("#snackbar").addClass("show"),$("#div_location").text(n.location)):$("#snackbar").removeClass("show"),errors.setting_category_channelLimit_error||errors.setting_category_channelUserLimit_error||errors.setting_prefix_error||errors.setting_category_namingRule_error?$("#save_button").prop("disabled",!0):$("#save_button").prop("disabled",!1)}function isInEquivalent(e,a,t){if("string"!=typeof t&&(t="guild"),Array.isArray(e)!=Array.isArray(a))return{location:t};if(Array.isArray(e))for(var l=0;l<e.length;l++){if(typeof(n=e[l])!=typeof(r=a[l]))return{location:t+"["+l+"]"};if("object"==typeof n){if(s=isInEquivalent(n,r,t+"["+l+"]"))return s}else if(n!=r)return{location:t+"["+l+"]"}}else{var i=Object.getOwnPropertyNames(e),o=Object.getOwnPropertyNames(a);if(i.length!=o.length)return{location:t};for(l=0;l<i.length;l++){var n,r,s,c=i[l];if(typeof(n=e[c])!=typeof(r=a[c]))return{location:t+"."+c};if("object"==typeof n){if(s=isInEquivalent(n,r,t+"."+c))return s}else if(n!=r)return{location:t+"."+c}}}return!1}"/guild.html"==location.pathname&&($(window).focus((function(){$.getJSON("/api/inftalks/tokenvalid",(function(e){e.valid||location.reload()}))})),$("#save_button").click((function(e){e.preventDefault(),saveGuildData()})),$("#undo_button").click((function(e){e.preventDefault(),undoGuildData()})),$(".settings.value").each((function(){$(this).change((function(e){var a=$(e.currentTarget);switch(a.prop("id")){case"setting_language":console.log("guild.language: "+a.val()),localGuildData.guild.language=""+a.val();break;case"setting_prefix":console.log("guild.prefix: "+a.val().trimLeft()),localGuildData.guild.prefix=""+a.val().trimLeft();break;case"setting_category":console.log("selectedCategory.id: "+a.val()),selectedCategory=null,selectedCategory=localGuildData.guild.categorys.find((function(e){return e.id==a.val()}));break;case"setting_category_enable":console.log("selectedCategory.enableInfTalks: "+a.is(":checked")),selectedCategory.enableInfTalks=a.is(":checked");break;case"setting_category_allowLock":console.log("selectedCategory.allowLock: "+a.is(":checked")),selectedCategory.allowLock=a.is(":checked");break;case"setting_category_channelLimit":console.log("selectedCategory.channelLimit: "+a.val()),selectedCategory.channelLimit=parseInt(a.val()),isNaN(selectedCategory.channelLimit)&&(selectedCategory.channelLimit=0);break;case"setting_category_channelUserLimit":console.log("selectedCategory.channelUserLimit: "+a.val()),selectedCategory.channelUserLimit=parseInt(a.val()),isNaN(selectedCategory.channelUserLimit)&&(selectedCategory.channelUserLimit=0);break;case"setting_category_namingRule":console.log("selectedCategory.namingRule: "+a.val().trim()),selectedCategory.namingRule=""+a.val().trim()}updateData()}))})),loadGuildData());